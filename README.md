# Picture Designer

~~本项目主要采用 MVC 设计模式，使用控制器来处理各种MFC的消息，使用模型来储存各类数据，使用视图来实现渲染~~

我反悔了，这样设计过于麻烦了，我决定将模型和渲染管理到一起！

控制器将每一次动作制作成 command，然后发送给对应的模型，进而实现 redo 和 undo 操作，每次操作参考 PowerPoint，比如调整图形大小，应该在鼠标焦点丢失的时候作为一次编辑。

将所有模型抽象化成一个基类管理，每次渲染都由控制器向模型递归发送指令，当然，只有被修改过的模型才需要重新渲染，不过这个时候又涉及到了模型的覆盖问题。

目前的解决方案或许是设置一个 z-order，然后如果有一个图形需要修改，就计算它的最小覆盖矩形，然后在这个图形上层并且被波及的图形都需要重新渲染。

> ~~我淦，还有一个问题，~~线条变细和大小变小都需要设置一个原始状态的最小覆盖矩形，然后在编辑完之后对这两个矩形进行大小比较，或者发送渲染消息的时候模型直接同时和这两个矩形进行比较

当我们选中一个图形的时候，我们临时将它的 z-order 设置为最高, 但是临时修改其颜色，使其变淡，同时，我们需要修改虚线，或者直接显示最小覆盖矩形，比如说设置这样的规则：

1. 所有 z-order 的范围是 [-100, 100]
2. 临时提升层级的时候将 order 设置为 101


# 使用一个总体的类

## 三角形

### 相关状态设置

- 三角形模式：处于三角形绘制状态，逻辑将会改变；

- 根据行为模式(1.)，设置一静态全局变量以确定半径；

### 行为模式

按下左键开始，此后每次按下左键都表示确定一个点，这时有两种行为逻辑：

1. 在起始点再按下一次按键表示结束（目前设计为在起始点一个固定半径内左键为结束）,可以为多边形设计铺垫；

2. 第二次按下左键结束，自动连接第三条线。

> 或许可以扩展为多边形模式
>
> 已有的等腰三角形模式后续或许可以扩展为按住shift绘制等边，否则绘制等腰

### 设计思路

1. 在三角形模式下，当按下左键时，开始绘制，按下左键的总函数，根据状态变量确定，使用什么子函数；此时还有一些痛点：
    - 不停绘制，不停擦除（这个地方可以抽象出一个绘制直线的子函数，传递起点，终点以及宽度给它，只要获取到背景色，我们就可以通过绘制直线的方式来擦除直线，
    另外，我们或许可以将擦除时直线宽度增大以保证直线擦除）
    - 如何判断一次点击，我们可以以松开左键的位置作为起始点，通过一个状态确定前面左键是pressed的